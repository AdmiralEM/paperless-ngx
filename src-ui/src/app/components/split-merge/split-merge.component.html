<app-page-header i18n-title title="Split & Merge Editor">
  <div class="btn-group mr-5">
    <button class="btn btn-sm btn-outline-danger" (click)="cancel()">
      <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
        <use xlink:href="assets/bootstrap-icons.svg#slash-circle" />
      </svg>&nbsp;<ng-container i18n>Cancel</ng-container>
    </button>
  </div>

  <div class="btn-group ml-5">
    <button class="btn btn-sm btn-outline-primary" (click)="save()" [disabled]="splitMergeService.getDocuments().length < 1">
      <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
        <use xlink:href="assets/bootstrap-icons.svg#check-circle" />
      </svg>&nbsp;<ng-container i18n>Save</ng-container>
    </button>
  </div>
</app-page-header>

<div class="row">
  <div class="col-lg-6">
    <div class="btn-toolbar" role="toolbar">
      <button class="btn btn-sm btn-outline-primary w-100" (click)="chooseDocuments()">
        <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
          <use xlink:href="assets/bootstrap-icons.svg#plus-circle" />
        </svg>&nbsp;<ng-container i18n>Add Documents</ng-container>
      </button>
    </div>
    <div class="py-4" dndDropzone (dndDrop)="onDrop($event, documents)">
      <div class="spacer bg-primary" dndPlaceholderRef>
      </div>
      <div *ngFor="let d of documents; let i = index" class="card w-100 mb-3" [class.separator-card]="d.is_separator" [dndDraggable]="d" dndEffectAllowed="move" (dndMoved)="onDragged(d, documents)">
        <ng-container *ngIf="d.is_separator">
          <div class="separator"></div>
          <h6 class="text-muted small font-weight-bold d-inline-block pt-2 px-3 mb-2 mx-auto bg-body" i18n>Document End</h6>
          <button class="btn btn-sm btn-danger" title="Remove" (click)="removeDocument(d, i)">
            <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
              <use xlink:href="assets/bootstrap-icons.svg#trash" />
            </svg>
          </button>
        </ng-container>
        <div *ngIf="!d.is_separator" class="row no-gutters">
          <div class="col-md-3 d-flex handle">
            <svg width="2em" height="100%" viewBox="0 0 16 16" fill="currentColor" class="mx-auto">
              <use xlink:href="assets/bootstrap-icons.svg#grip-horizontal" />
            </svg>
            <div class="doc-thumb" [style.background-image]="'url(' + getThumbUrl(d.id) + ')'"></div>
          </div>
          <div class="col-md-9">
            <div class="card-body p-3">
              <h6 class="card-title mb-2">{{d.title}}</h6>
              <div class="card-actions">
                <div class="btn-toolbar btn-toolbar-sm justify-content-between w-100">
                  <button class="btn btn-sm btn-outline-danger flex-fill" title="Remove" (click)="removeDocument(d, i)">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
                      <use xlink:href="assets/bootstrap-icons.svg#trash" />
                    </svg><span class="d-none d-xl-inline">&nbsp;<ng-container i18n>Remove</ng-container></span>
                  </button>
                  <button class="btn btn-sm btn-outline-primary ml-2 flex-fill" title="Split" (click)="chooseSplit(d, i)">
                    <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
                      <use xlink:href="assets/bootstrap-icons.svg#scissors" />
                    </svg><span class="d-none d-xl-inline">&nbsp;<ng-container i18n>Split</ng-container></span>
                  </button>
                </div>
                <div class="input-group input-group-sm w-100 mt-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text"><ng-container i18n>Pages</ng-container>:</div>
                  </div>
                  <app-input-debounce delay="500" classes="form-control-sm" placeholder="All" ngbTooltip="e.g. 1-3,5" [inputValue]="formatPages(d.pages)" (value)="pagesFieldChange($event, d, i)"></app-input-debounce>
                  <div class="input-group-append">
                    <button class="btn btn-outline-primary" type="button" (click)="choosePages(d, i)">
                      <svg width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor">
                        <use xlink:href="assets/bootstrap-icons.svg#pencil" />
                      </svg><span class="d-none d-xl-inline">&nbsp;<ng-container i18n>Select Pages</ng-container></span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <ng-container *ngIf="previewUrls.length > 1">
      <ul ngbNav #previewNav="ngbNav" class="nav-tabs">
        <li *ngFor="let previewUrl of previewUrls; let j = index" [ngbNavItem]="j">
          <a class="bg-light" ngbNavLink><ng-container i18n>Document</ng-container> {{j + 1}}</a>
          <ng-template ngbNavContent>
            <div class="preview-container tabbed text-center bg-light">
              <h6 class="my-2 text-muted" i18n>Preview</h6>
              <div *ngIf="loading" class="spinner-border" role="status">
                <span class="sr-only" i18n>Loading...</span>
              </div>
              <pdf-viewer [src]="previewUrl" [original-size]="false" [show-borders]="true" [show-all]="true" [render-text-mode]="2" (after-load-complete)="pdfPreviewLoaded($event)"></pdf-viewer>
            </div>
          </ng-template>
        </li>
      </ul>
      <div [ngbNavOutlet]="previewNav"></div>
    </ng-container>
    <div *ngIf="previewUrls.length <= 1" class="preview-container text-center bg-light">
      <h6 class="my-2 text-muted" i18n>Preview</h6>
      <div *ngIf="loading" class="spinner-border" role="status">
        <span class="sr-only" i18n>Loading...</span>
      </div>
      <pdf-viewer [src]="previewUrls[0]" [original-size]="false" [show-borders]="true" [show-all]="true" [render-text-mode]="2" (after-load-complete)="pdfPreviewLoaded($event)"></pdf-viewer>
    </div>
  </div>
</div>
